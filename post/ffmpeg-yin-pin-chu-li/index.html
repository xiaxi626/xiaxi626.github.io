
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>FFmpeg音频处理 | 飞爱碧玉的个人博客</title>
<meta name="description" content="温故而知新">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.1/css/all.css" crossorigin="anonymous">
<link rel="shortcut icon" href="https://xiaxi626.github.io/favicon.ico?v=1708146931921">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://xiaxi626.github.io/styles/main.css">

<script src="https://xiaxi626.github.io/media/scripts/vue.js"></script>
<script src="https://xiaxi626.github.io/media/scripts/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.5.0/tocbot.min.js"></script>
  </head>
  <body>
    <div class="carousel carousel-slider center index-cover" data-indicators="true">
    <div class="bg-cover pd-header" style="background: url('https://xiaxi626.github.io/post-images/ffmpeg-yin-pin-chu-li.jpg') no-repeat center center fixed" data-link="https://xiaxi626.github.io/post/ffmpeg-yin-pin-chu-li/">
        <div class="container">
            <div class="row">
                <div class="col s10 offset-s1 m8 offset-m2 l8 offset-l2">
                    <div class="brand">
                        <div class="title center-align">
                            FFmpeg音频处理
                        </div>
                        <div class="description center-align">
                            <span id="subtitle">
                                
                            </span><span class="typed-cursor">|</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11"></script>
<script>
    window.onload = function () {
        var typed = new Typed("#subtitle", {
            strings: [ 
                
                    "从来没有真正的绝境, 只有心灵的迷途",
                
                    '',

            ],
            startDelay: 300,
            typeSpeed: 100,
            loop: true,
            backSpeed: 50,
            showCursor: true
        });
        let cover = document.querySelector('.bg-cover');
        cover.setAttribute('style', `background: url('${localStorage[cover.dataset.link]}') no-repeat center center fixed`);
    }
</script>


    <div class="toc-body hide">  
        <div class="toc"></div>
    </div>
    <div id="floating-toc-btn">
        <i class="fas fa-list-ul bg-color"></i>
    </div>
    <div id="app" class="main">
      <div class="site-header-container nav-transparent">
  <div class="site-header">
    <div class="left">
      <a href="https://xiaxi626.github.io">
        <img class="avatar" src="https://xiaxi626.github.io/images/avatar.png?v=1708146931921" alt=""
          width="32px" height="32px">
      </a>
      <a href="https://xiaxi626.github.io">
        <h1 class="site-title">
          飞爱碧玉的个人博客
        </h1>
      </a>
    </div>
    <div class="right">
        <div class="menu">
            <a href="/post/about" v-if="headSearchShow">
                <i class="fa-solid fa-user"></i>&nbsp;个人
            </a>
            <a href="/archives" v-if="headSearchShow">
                <i class="fa-solid fa-box-archive"></i>&nbsp;归档
            </a>
            <a href="/tags" v-if="headSearchShow">
                <i class="fa-solid fa-tag"></i>&nbsp;标签
            </a>
            <a href="/life" v-if="headSearchShow">
                <i class="fa-fw fas fa-heart"></i>&nbsp;生活
            </a>
            
        </div>
      <div class="gridea-search-div" v-if="headSearchShow">
        <form id="gridea-search-form" action="https://xiaxi626.github.io/search/">
          <input class="gridea-search-input" autocomplete="off" spellcheck="false" name="q" />
        </form>
      </div>
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }"
          @click="menuClick()" v-if="menuSearchShow"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      <div class="gridea-search-div" v-if="menuSearchShow">
        <form id="gridea-search-form" action="https://xiaxi626.github.io/search/">
          <input class="gridea-search-input" autocomplete="off" spellcheck="false" name="q" />
        </form>
      </div>
      
        
            <a href="/" class="menu purple-link">
              首页
            </a>
            
              
        
            <a href="/archives" class="menu purple-link">
              归档
            </a>
            
              
        
            <a href="/tags" class="menu purple-link">
              标签
            </a>
            
              
        
            <a href="/post/about" class="menu purple-link">
              关于
            </a>
            
              
        
            <a href="/friends" class="menu purple-link">
              友情链接
            </a>
            
              
              
    </div>
  </div>
</transition>

<script>
    window.onscroll = function () {
        var t = document.documentElement.scrollTop || document.body.scrollTop;
        var header = document.querySelector('.site-header-container');
        if (t > 0) {
            header.classList.remove('nav-transparent');
        } else {
            header.classList.add('nav-transparent');
        }
    }
</script>

      <div class="content-body">
        <div class="content-container content-card">
            <div class="post-detail">
              <div class="post-info post-detail-info">
                <span><i class="icon-calendar-outline"></i> 2021-11-02</span>
                
                  <span>
                    
                        <i class="icon-pricetags-outline"></i>
                      <a href="https://xiaxi626.github.io/tag/JcIpV52xSP/">
                        Technology
                      </a>
                    
                  </span>
                
              </div>
              
              <hr class="clear">
              <div class="post-content">
                <h2 id="音频信息">音频信息</h2>
<h3 id="查看音频信息">查看音频信息</h3>
<pre><code class="language-bash">ffmpeg -i video.mp4
</code></pre>
<h3 id="查看网络视频的信息">查看网络视频的信息</h3>
<pre><code class="language-bash">ffmpeg -i http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4
</code></pre>
<h2 id="查看音频的布局情况">查看音频的布局情况</h2>
<pre><code class="language-bash">ffmpeg -layouts
</code></pre>
<h2 id="音频抽取">音频抽取</h2>
<h3 id="从视频文件中抽取音频">从视频文件中抽取音频</h3>
<h4 id="提取完整音频">提取完整音频</h4>
<pre><code class="language-bash">ffmpeg -i sample.mp4 -q:a 0 -map a sample.mp3
</code></pre>
<h4 id="提取指定时间段的音频">提取指定时间段的音频</h4>
<pre><code class="language-bash">ffmpeg -i sample.mp4 -ss 00:03:05 -t 00:00:45.0 -q:a 0 -map a sample.mp3
</code></pre>
<h4 id="不重新编码">不重新编码</h4>
<p>提取格式不能为MP3，可以是aac和m4a，请执行以下操作：</p>
<pre><code class="language-bash">ffmpeg -i input-video.avi -vn -acodec copy output-audio.aac
</code></pre>
<p>-acodec 表示音频解码方式，-vn表示去除视频</p>
<h4 id="重新编码">重新编码</h4>
<p>下面是如何使用FFmpeg从视频中提取音频，然后使用libmp3lame将音频编码为不同的质量，并将其存储为mp3文件。</p>
<pre><code class="language-bash">ffmpeg.exe -i videoWithAudio.mp4 -vn -c:a libmp3lame -q:a 1 onlyAudio.mp3
</code></pre>
<p>-q:a表示质量（在LAME文档中定义[1]），质量分布范围为0~6，其中0表示高质量音频，6表示低质量音频。</p>
<h3 id="从网络视频文件中抽取音频">从网络视频文件中抽取音频</h3>
<pre><code class="language-bash">ffmpeg -i http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4 -acodec copy -vn out_net.mp4
</code></pre>
<p>-acodec 用于音频的编码设置</p>
<h2 id="合并">合并</h2>
<h3 id="一种方法是连接到一起">一种方法是连接到一起</h3>
<pre><code class="language-bash">ffmpeg64.exe -i &quot;concat:123.mp3|124.mp3&quot; -acodec copy output.mp3
</code></pre>
<p>解释：-i代表输入参数<br>
contact:123.mp3|124.mp3代表着需要连接到一起的音频文件<br>
-acodec copy output.mp3 重新编码并复制到新文件中</p>
<h3 id="另一种方法是混合到一起">另一种方法是混合到一起</h3>
<pre><code class="language-bash">ffmpeg64.exe -i 124.mp3 -i 123.mp3 -filter_complex amix=inputs=2:duration=first:dropout_transition=2 -f mp3 remix.mp3
</code></pre>
<p>解释：-i代表输入参数<br>
-filter_complex ffmpeg滤镜功能，非常强大，详细请查看文档<br>
amix是混合多个音频到单个音频输出<br>
inputs=2代表是2个音频文件，如果更多则代表对应数字<br>
duration 确定最终输出文件的长度<br>
longest(最长)|shortest（最短）|first（第一个文件）<br>
dropout_transition<br>
The transition time, in seconds, for volume renormalization when an input stream ends. The default value is 2 seconds.<br>
-f mp3  输出文件格式</p>
<h2 id="删除音频">删除音频</h2>
<h3 id="删除视频中的音频">删除视频中的音频</h3>
<p>只将视频复制到一个新的文件中，而不复制音频。</p>
<pre><code class="language-bash">ffmpeg.exe -i videoWithAudio.mp4 -c:v copy -an videoWithoutAudio.mp4
</code></pre>
<ul>
<li>使用-c:v copy命令将视频复制到videoWithoutAudio.mp4</li>
<li>-an告诉FFmpeg不要复制音频</li>
</ul>
<p>上述方法非常适用于电影中只有一个音轨的情况。</p>
<h3 id="删除某个特定音轨">删除某个特定音轨</h3>
<p>你可以使用FFmpeg中的map命令来删除特定音轨。</p>
<p>map命令的通用语法是：</p>
<p><code>-map input_file_index:stream_type_specifier:stream_index</code></p>
<p>然后，你可以通过<code>-map 0:a:1</code>（从0开始计数）从视频中选择第二个音轨。在上文的例子中，如果你的文件中有一个视频和两个音轨，那么你就可以使用<code>-map 0:a:1</code>只选择第二个音轨，并将它复制到你的最终输出文件中。</p>
<p>同样，-map 0是指选择第一个输入文件中的所有数据（包括音频和视频），所以你需要先选择所有数据，然后取消选择音频。</p>
<pre><code class="language-bash">ffmpeg.exe -i videoWithAudio.mp4 -map 0 -map 0:a:1 -copy videoOutput.mp4
</code></pre>
<p>如果电影中有5个音轨，除了第一个，其他你都想选择。这个时候你可以使用反向的map命令（在map命令的参数前加负号）。使用<code>-map -0:a:0</code> 这一命令，FFmpeg在选择时就会忽略第一个音轨。反向的map非常强大！</p>
<p>实际上，我们已在前文学习了使用 -an命令从视频中删除音频。你可以通过如下方式，使用反向的map来达到相同的效果。</p>
<pre><code class="language-bash">ffmpeg -i videoWithAudio.mp4 -map 0 -map -0:a videoWithoutAudio.mp4
</code></pre>
<h2 id="添加音频">添加音频</h2>
<pre><code class="language-bash">ffmpeg -i video.mp4 -i audio.mp3 -c copy -map 0:v:0 -map 1:a:0 
videoWithAudio.mp4
</code></pre>
<p>使用map命令将视频和音频分别从不同的文件中复制到同一个输出文件。</p>
<ul>
<li><code>-map 0:v:0</code> 选择了第0个输入文件（视频输入）的第0个轨道。</li>
<li><code>–map 1:a:0</code> 选择了第一个输入文件（音频输入）的第0个轨道。</li>
<li>不用重新编码，-c copy同时复制音轨和视轨到输出文件。如果你想要重新编码，可以选择合适的音视频编解码器，配置相应的编码质量。</li>
</ul>
<h2 id="替换音频">替换音频</h2>
<p>请看下列命令行：<br>
<code>-map input_file_index:stream_type_specifier:stream_index.</code><br>
所以，你可以使用<code>-map 1:a:2</code>来选择第二个输入文件中的第三个音轨，因为计数从0开始。</p>
<pre><code class="language-bash">ffmpeg -i video_with_audio.mp4 -i newAudio.wav -map 0:0 -map 1:0 -c:v copy -c:a libmp3lame -q:a 1 -shortest  video_with_newAudio.mp4
</code></pre>
<p>在上文的例子中，我们需要从一个文件中获取视频以及另一个文件中获取音频。而map命令非常便捷地完成了上述操作。我们从第一个输入文件（视频）中选择第0个轨道，并从第2个输入文件（音频）中选择第0个轨道。</p>
<p>然后我们原样复制视频并重新编码音频，再将它们一起放入新的文件中。如果你不想重新编码音频，你只需使用-a:c copy命令，那么音频就只被复制而不会重新编码。</p>
<p>-shortest命令用于确保当达到较短的输入文件（两个输入文件之一）长度时停止转换。如果这个功能在你的用例中无关紧要，那么你可以不使用这一命令。</p>
<h2 id="绘制音频波形图">绘制音频波形图</h2>
<h3 id="绘制多声道混合的音频波形图">绘制多声道混合的音频波形图</h3>
<pre><code class="language-bash">ffmpeg -i music.mp3 -filter_complex &quot;showwavespic=s=640*120&quot; -frames:v 1 output.png
</code></pre>
<h3 id="绘制不同声道的波形图">绘制不同声道的波形图</h3>
<pre><code class="language-bash">ffmpeg -i 1.mp3 -filter_complex &quot;showwavespic=s=640*240:split_channels=1&quot; -frames:v 1 output.png
</code></pre>
<h2 id="使用多媒体滤镜-ebur128分析音频响度变化">使用多媒体滤镜 ebur128分析音频响度变化</h2>
<p>ebur128扫描滤镜。这个滤镜需要一个音频流，但会原样输出。默认情况下，它以10Hz的频率记录一条消息，其中包括瞬时响度(由M标识)、短期响度(S)、综合响度(I)和响度范围(LRA)。</p>
<p>滤镜有个实时的输出，展示响度的变化，主要的绘图区域包含短期响度（3秒分析），以及其后的舒适响度（400毫秒）</p>
<p>具体参数：https://ffmpeg.org/ffmpeg-all.html#ebur128-1</p>
<pre><code class="language-bash">ffmpeg -nostats -i stars.mp3 -filter_complex ebur128 -f null -
</code></pre>
<p>加-report可把结果输出到日志文件</p>
<p><strong>利用EBU放缩规模计+18d的实时图像</strong></p>
<p><code>ffplay -f lavfi -i &quot;amovie=input.mp3,ebur128=video=1:meter=18 [out0][out1]&quot;</code></p>
<h2 id="改变格式">改变格式</h2>
<pre><code class="language-bash">ffmpeg -i audio.mp3 -f ogg out.ogg
</code></pre>
<p>-f ogg表示编码格式是ogg</p>
<h2 id="改变采样率">改变采样率</h2>
<pre><code class="language-bash">ffmpeg -i audio.mp3 -ar 8000 out.mp3
</code></pre>
<p>-ar 用于设置音频采样率</p>
<h2 id="改变比特率">改变比特率</h2>
<pre><code class="language-bash">ffmpeg -i audio.mp3 -ab 5000 out.mp3
</code></pre>
<p>-ab 用于设置音频比特率</p>
<h2 id="片段截取">片段截取</h2>
<p>-ss 表示开始时间（时：分：秒），-to 表示结束时间（时：分：秒），-t 表示截取时长（时：分：秒）</p>
<pre><code class="language-bash">ffmpeg -i audio.mp3 -ss 0:0:10 -to 0:0:20 out.mp3
ffmpeg -i audio.mp3 -ss 0:0:10 -t 0:0:20 out.mp3
</code></pre>
<p>也可以像下面这样，以秒为单位。</p>
<pre><code class="language-bash">ffmpeg -i audio.mp3 -ss 10 -t 20 out.mp3
</code></pre>
<p>-ss用于设置开始时间，-t用于设置持续时间</p>
<h2 id="音频声道">音频声道</h2>
<h3 id="改变声道">改变声道</h3>
<pre><code class="language-bash">ffmpeg -i audio.mp3 -ac 1 out.mp3
</code></pre>
<p>-ac 用于设置声道，1表示单声道，2表示立体声</p>
<h3 id="双声道合并单声道">双声道合并单声道</h3>
<pre><code class="language-bash">ffmpeg -i music.mp3 -ac 1 music.aac
</code></pre>
<h3 id="单声道转双声道">单声道转双声道</h3>
<pre><code class="language-bash">ffmpeg -i left.aac -ac 2 output.m4a
</code></pre>
<h3 id="双声道的提取">双声道的提取</h3>
<p>-map_channel [input_file_id.stream_specifier.channel_id|-1][?][:output_file_id.stream_specifier]<br>
<strong>方式一：</strong></p>
<pre><code class="language-bash">ffmpeg -i music.mp3 -map_channel 0.0.0 letf.aac -map_channel 0.0.1 right.aac
</code></pre>
<p><strong>方式二：</strong><br>
<a href="http://ffmpeg.org/ffmpeg-all.html#pan-1">使用pan滤镜</a></p>
<pre><code class="language-bash">ffmpeg -i music.mp3 -filter_complex &quot;[0:0]pan=1c|c0=c0[left];[0:0]pan=1c|c0=c1[right]&quot; -map &quot;[left]&quot; left.aac -map &quot;[right]&quot; right.aac -y
</code></pre>
<h3 id="双声道转双音频流把双声道音频提取出来转为一个音频文件两个音频流">双声道转双音频流，把双声道音频提取出来转为一个音频文件两个音频流</h3>
<pre><code class="language-bash">ffmpeg -i music.mp3 -filter_complex channelsplit=channel_layout=stereo output.mka
</code></pre>
<p>可以看到生成的视频就包含了两个流，大多默认情况下播放器只会播放第一个流</p>
<h3 id="将两个音频源合并为双声道">将两个音频源合并为双声道</h3>
<pre><code class="language-bash">ffmpeg -i left.aac -i right.aac -filter_complex &quot;[0:a][1:a]amerge=inputs=2[aout]&quot; -map &quot;[aout]&quot; output.mka
</code></pre>
<p>//mka为acc编码格式</p>
<h2 id="音频音量">音频音量</h2>
<h3 id="音频音量探测">音频音量探测</h3>
<pre><code class="language-bash">ffmpeg -i test.mp4 -filter_complex volumedetect -c:v copy -f null /dev/null
</code></pre>
<p>mean_volume为获得音频的平均大小</p>
<h3 id="音量设置">音量设置</h3>
<h4 id="使用-vol选项">使用-vol选项</h4>
<pre><code class="language-bash">ffmpeg -i music.mp3 -vol 30 sound_low.mp3
</code></pre>
<p>-vol选项接受从0到256的整数值，其中256是最大值</p>
<h4 id="使用表中描述的卷过滤器">使用表中描述的卷过滤器</h4>
<p><strong>音量降低到三分之二</strong></p>
<pre><code class="language-bash">ffmpeg -i music.mp3 -af volume=2/3 quiet_music.mp3
</code></pre>
<p><strong>增加10分贝的音量</strong></p>
<pre><code class="language-bash">ffmpeg -i music.mp3 -af volume=10dB louder_sound.mp3
</code></pre>
<h2 id="加快减慢音频节奏">加快/减慢音频节奏</h2>
<h3 id="加快">加快</h3>
<p><code>ffplay music.mp3 -af atempo=1.5</code></p>
<h3 id="减慢">减慢</h3>
<p><code>ffplay music.mp3 -af atempo=0.5</code></p>
<h2 id="chorus-给声音添加合唱效果">chorus 给声音添加合唱效果</h2>
<p>可以让独唱变得像合唱，但也可以用于仪表。</p>
<p>合唱与回声效应都有短延迟,但是回波延迟是常数,合唱则采用不同的正弦或三角调制。调制深度范围定义了调制延迟(播放之前或之后的延迟)。因此延迟的声音听起来较慢或更快,这是原来周围的延迟调整声音,像是有一个与合唱整体略微差异。</p>
<p>它接受下面的参数（每个参数项如果有多个可能值用|分隔）：</p>
<p>in_gain</p>
<p>设置输出增益，默认0.4</p>
<p>out_gain</p>
<p>设置输出增益，默认0.4</p>
<p>delays</p>
<p>设置延迟，延迟通常在40ms-60ms</p>
<p>decays</p>
<p>设置衰减</p>
<p>speeds</p>
<p>设置速度</p>
<p>depths</p>
<p>设置深度</p>
<p>例子</p>
<p>一个延迟（二人合唱效果）</p>
<p><code>chorus=0.7:0.9:55:0.4:0.25:2</code></p>
<p>两个延迟（三人合唱效果）</p>
<p><code>ffplay music.mp3 -af &quot;chorus=0.6:0.9:50|60:0.4|0.32:0.25|0.4:2|1.3&quot;</code></p>
<p>三个延迟（四人及更多合唱效果）</p>
<p><code>horus=0.5:0.9:50|60|40:0.4|0.32|0.3:0.25|0.4|0.3:2|2.3|1.3</code></p>
<h1 id="参考文章">参考文章</h1>
<p><a href="https://blog.csdn.net/PYJTRK/article/details/122837821">FFMPEG常用命令（一）：音视频信息与抽取</a><br>
<a href="https://blog.csdn.net/PYJTRK/article/details/122843712">FFMPEG常用命令（三）：音频相关命令</a><br>
<a href="https://blog.csdn.net/sinat_14826983/article/details/82975561">ffmpeg常用音频处理</a><br>
<a href="https://zhuanlan.zhihu.com/p/493712303">使用FFmpeg添加、删除、替换和提取视频中的音频</a><br>
<a href="https://www.cnblogs.com/CodeAndMoe/p/13360011.html">🔨 FFmpeg 提取视频的音频 </a><br>
<a href="https://www.cnblogs.com/simadi/p/10649345.html">ffmpeg 多个音频合并 截取 拆分</a></p>

              </div>
              <hr class="clear">
              
                <div class="next-post">
                  <a class="purple-link" href="https://xiaxi626.github.io/post/ffmpeg-tu-pian-chu-li/">
                    <h3 class="post-title">
                      下一篇：FFmpeg图片处理
                    </h3>
                  </a>
                </div>
                
            </div>
          </div>
      </div>

      
          <div id="gitalk-container"></div>
      

    
    </div>
    <div class="site-footer">
  <div class="social-container">
    
      
        <a href="https://github.com/xiaxi626" target="_blank">
          <i class="fab fa-github"></i>
        </a>
      
    
      
    
      
    
      
    
      
        <a href="https://space.bilibili.com/328031473/bangumi" target="_blank">
          <i class="fab fa-bilibili"></i>
        </a>
      
    
      
        <a href="https://www.zhihu.com/people/xiao-yan-shi-36" target="_blank">
          <i class="fab fa-zhihu"></i>
        </a>
      
    
  </div>
  <div class="slogan">温故而知新</div> |
  <a href="https://github.com/Decade-qiu/gridea-theme-Eternal" target="_blank">Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a></a> | <a href="https://github.com/Decade-qiu/gridea-theme-Eternal" target="_blank">Powered by Eternal</a> | <a href="https://xiaxi626.github.io/atom.xml" target="_blank">RSS</a>
</div>

    <script src="https://xiaxi626.github.io/media/scripts/index.js"></script>


    <script src='https://xiaxi626.github.io/media/scripts/valine.min.js'></script>
    <script>
        new Valine({
            el: '#gitalk-container',
            appId: '2EhI3kZCg0PpwHaW4CRpwsYu-gzGzoHsz',
            appKey: 'XEh9nruDRqlHqqfaFkHmeyKq',
            placeholder: 'Write something...',
        })
    </script>



  </body>
</html>

<script>
    window.onload = function() {
        let id = 1;
        let post_content = document.querySelector('.content-card');
        post_content.querySelectorAll('h1,h2,h3,h4,h5,h6').forEach(function (item) {
            item.setAttribute('id', 'toc-' + id);
            id++;
        });
        tocbot.init({
            tocSelector: '.toc',
            contentSelector: '.post-content',
            headingSelector: 'h1,h2,h3,h4',
            headingsOffset: 58,
        });
        // 检测页面滚动距离 用eventlistener
        window.addEventListener('scroll', function () {
            let scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
            let toc = document.querySelector('.toc');
            let tocBtn = document.querySelector('.toc-body');
            if (scrollTop > 250) {
                tocBtn.classList.add('toc-body-fixed');
                toc.classList.add('toc-fixed');
            } else {
                tocBtn.classList.remove('toc-body-fixed');
                toc.classList.remove('toc-fixed');
            }
        });
        document.querySelector('#floating-toc-btn').addEventListener('click', function () {
            let toc = document.querySelector('.toc-body');
            let main = document.querySelector('.main');
            if (toc.classList.contains('hide')) {
                main.classList.add('main-small');
                toc.classList.remove('hide');
            } else {
                toc.classList.add('hide');
                main.classList.remove('main-small');
            }
        });
        window.addEventListener('resize', function() {
            // 获取屏幕宽度
            var screenWidth = window.innerWidth || document.documentElement.clientWidth;
            // 设置 .content-card 的 max-width
            var contentCard = document.querySelector('.content-card');
            contentCard.style.maxWidth = screenWidth + 'px';
        });
        // 初始加载时执行一次，确保初始状态下也设置正确
        window.dispatchEvent(new Event('resize'));
    };
</script>

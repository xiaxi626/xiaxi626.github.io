
<!DOCTYPE html>
<html>
  <head>
    
<meta charset="utf-8" >

<title>FFmpeg图片处理 | 飞爱碧玉的个人博客</title>
<meta name="description" content="温故而知新">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.1/css/all.css" crossorigin="anonymous">
<link rel="shortcut icon" href="https://xiaxi626.github.io/favicon.ico?v=1708146931921">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://xiaxi626.github.io/styles/main.css">

<script src="https://xiaxi626.github.io/media/scripts/vue.js"></script>
<script src="https://xiaxi626.github.io/media/scripts/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.5.0/tocbot.min.js"></script>
  </head>
  <body>
    <div class="carousel carousel-slider center index-cover" data-indicators="true">
    <div class="bg-cover pd-header" style="background: url('https://xiaxi626.github.io/post-images/ffmpeg-tu-pian-chu-li.jpg') no-repeat center center fixed" data-link="https://xiaxi626.github.io/post/ffmpeg-tu-pian-chu-li/">
        <div class="container">
            <div class="row">
                <div class="col s10 offset-s1 m8 offset-m2 l8 offset-l2">
                    <div class="brand">
                        <div class="title center-align">
                            FFmpeg图片处理
                        </div>
                        <div class="description center-align">
                            <span id="subtitle">
                                
                            </span><span class="typed-cursor">|</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11"></script>
<script>
    window.onload = function () {
        var typed = new Typed("#subtitle", {
            strings: [ 
                
                    "从来没有真正的绝境, 只有心灵的迷途",
                
                    '',

            ],
            startDelay: 300,
            typeSpeed: 100,
            loop: true,
            backSpeed: 50,
            showCursor: true
        });
        let cover = document.querySelector('.bg-cover');
        cover.setAttribute('style', `background: url('${localStorage[cover.dataset.link]}') no-repeat center center fixed`);
    }
</script>


    <div class="toc-body hide">  
        <div class="toc"></div>
    </div>
    <div id="floating-toc-btn">
        <i class="fas fa-list-ul bg-color"></i>
    </div>
    <div id="app" class="main">
      <div class="site-header-container nav-transparent">
  <div class="site-header">
    <div class="left">
      <a href="https://xiaxi626.github.io">
        <img class="avatar" src="https://xiaxi626.github.io/images/avatar.png?v=1708146931921" alt=""
          width="32px" height="32px">
      </a>
      <a href="https://xiaxi626.github.io">
        <h1 class="site-title">
          飞爱碧玉的个人博客
        </h1>
      </a>
    </div>
    <div class="right">
        <div class="menu">
            <a href="/post/about" v-if="headSearchShow">
                <i class="fa-solid fa-user"></i>&nbsp;个人
            </a>
            <a href="/archives" v-if="headSearchShow">
                <i class="fa-solid fa-box-archive"></i>&nbsp;归档
            </a>
            <a href="/tags" v-if="headSearchShow">
                <i class="fa-solid fa-tag"></i>&nbsp;标签
            </a>
            <a href="/life" v-if="headSearchShow">
                <i class="fa-fw fas fa-heart"></i>&nbsp;生活
            </a>
            
        </div>
      <div class="gridea-search-div" v-if="headSearchShow">
        <form id="gridea-search-form" action="https://xiaxi626.github.io/search/">
          <input class="gridea-search-input" autocomplete="off" spellcheck="false" name="q" />
        </form>
      </div>
      <transition name="fade">
        <i class="icon" :class="{ 'icon-close-outline': menuVisible, 'icon-menu-outline': !menuVisible }"
          @click="menuClick()" v-if="menuSearchShow"></i>
      </transition>
    </div>
  </div>
</div>

<transition name="fade">
  <div class="menu-container" style="display: none;" v-show="menuVisible">
    <div class="menu-list">
      <div class="gridea-search-div" v-if="menuSearchShow">
        <form id="gridea-search-form" action="https://xiaxi626.github.io/search/">
          <input class="gridea-search-input" autocomplete="off" spellcheck="false" name="q" />
        </form>
      </div>
      
        
            <a href="/" class="menu purple-link">
              首页
            </a>
            
              
        
            <a href="/archives" class="menu purple-link">
              归档
            </a>
            
              
        
            <a href="/tags" class="menu purple-link">
              标签
            </a>
            
              
        
            <a href="/post/about" class="menu purple-link">
              关于
            </a>
            
              
        
            <a href="/friends" class="menu purple-link">
              友情链接
            </a>
            
              
              
    </div>
  </div>
</transition>

<script>
    window.onscroll = function () {
        var t = document.documentElement.scrollTop || document.body.scrollTop;
        var header = document.querySelector('.site-header-container');
        if (t > 0) {
            header.classList.remove('nav-transparent');
        } else {
            header.classList.add('nav-transparent');
        }
    }
</script>

      <div class="content-body">
        <div class="content-container content-card">
            <div class="post-detail">
              <div class="post-info post-detail-info">
                <span><i class="icon-calendar-outline"></i> 2021-11-02</span>
                
                  <span>
                    
                        <i class="icon-pricetags-outline"></i>
                      <a href="https://xiaxi626.github.io/tag/JcIpV52xSP/">
                        Technology
                      </a>
                    
                  </span>
                
              </div>
              
              <hr class="clear">
              <div class="post-content">
                <p><strong>说明</strong>：下面测试命令中<strong>image_source 是要处理的输入文件</strong>，<strong>out_source是处理完成之后的输出文件</strong></p>
<h2 id="1图片压缩">1.图片压缩</h2>
<p>ffmpeg可以很完美的压缩图片生成新图片，并可以设置压缩等级</p>
<pre><code class="language-bash">ffmpeg -i image_source -q compress_level out_source
#compress_level：压缩等级为正整数，数值越大压缩等级越高
</code></pre>
<h2 id="2等比放大">2.等比放大</h2>
<p>参数hqx。</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf hqx=4 out_source
</code></pre>
<p>效果是尺寸等比放大4倍</p>
<h2 id="3约束比例压缩">3.约束比例压缩</h2>
<p>ffmpeg可以将图片压缩成指定的尺寸</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf scale=width:height out_source
#width为压缩后的图片宽度
#height为压缩后的图片高度
#当width或height其中有一个数值为-1时将保持原来图片尺寸比例压缩
</code></pre>
<h2 id="4图片裁剪">4.图片裁剪</h2>
<p>ffmpeg可以指定图片裁剪位置和裁剪的图片尺寸</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf crop=width:height:from_x:from_y out_source
#width是要裁剪出的图片的宽度
#height是要裁剪出的图片的高度
#from_x是裁剪的起始X轴的位置
#from_y是裁剪的起始Y轴的位置
#如果不指定from_x和from_y表示从原始图片中心位置开始裁剪
</code></pre>
<h2 id="5添加水印图片">5.添加水印图片</h2>
<p>ffmpeg可以为图片添加水印，可以设置水印图片的大小、位置和透明度</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf movie=logo_source,scale=logo_width:logo_height,lut=a=val*opacity_num[watermask];[in][watermask] overlay=from_x:from_y[out] -y  out_source
#logo_source为水印图片地址
#logo_width为水印图片的宽度
#logo_height为水印图片的高度
#opacity_num为水印图片的透明度
#from_x为水印的起始X轴的位置
#from_y为水印的起始Y轴的位置
</code></pre>
<h2 id="6添加文字水印">6.添加文字水印</h2>
<p>ffmpeg可以为图片添加文字水印，可以设置字体、颜色、尺寸、文字内容、文字位置</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf drawtext=fontfile=font_ttf_path:fontcolor=font_color:fontsize=font_size:text=message_info:x=from_x:y=from_y  out_source
#font_ttf_path为字体路径，此项必须设置否则会出现字体无法找到的错误;
#字体路径要设置绝对路径并且要注意路径正反斜线转义(例如C\\:/Windows/Fonts/simhei.ttf)
#font_color为字体的颜色
#font_size为字体的大小
#message_info为水印文字内容
#from_x为水印的起始X轴的位置
#from_y为水印的起始Y轴的位置
#如果水印内容是中文需要设置中文字体否则会文字显示乱码
</code></pre>
<h2 id="7去logo">7.去logo</h2>
<p>参数delogo，在指定的区域作模糊处理，达到消除logo的效果。</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf delogo=x=0:y=0:w=50:h=50:band=5:show=1 out_source
</code></pre>
<p>band为模糊的强度，show为1时显示模糊的区域框，省略show或值为0时不显示区域框。</p>
<h2 id="8图片旋转指定的角度">8.图片旋转指定的角度</h2>
<p>ffmpeg可以将图片按照指定的角度旋转生成新图片</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf rotate=route_num*PI/180 -y  out_source
#route_num是要旋转的角度
#当route_num大于0的时候顺时针旋转,当route_num小于0的时候逆时针旋转
</code></pre>
<h2 id="9图片旋转特殊简便命令">9.图片旋转特殊简便命令</h2>
<p>上面的命令理论上可以完成所有的图片旋转操作，但ffmpeg仍然存在特殊简便旋转命令</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf transpose=route_number -y out_source
#route_number=0顺时针旋转90度再左右镜像
#route_number=1顺时针旋转90度
#route_number=2逆时针旋转90度
#route_number=3逆时针旋转90度再左右镜像
</code></pre>
<h2 id="10图片左右镜像">10.图片左右镜像</h2>
<pre><code class="language-bash">ffmpeg -i image_source -vf hflip out_source
</code></pre>
<h2 id="11将图片上下镜像">11.将图片上下镜像</h2>
<pre><code class="language-bash">ffmpeg -i image_source -vf vflip out_source
</code></pre>
<h2 id="12加边框">12.加边框</h2>
<p>参数drawbox。</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf drawbox out_source
</code></pre>
<p>在边界画一个实心的黑框</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf drawbox=x=10:y=10:w=200:h=100:color=red@0.5 out_source
</code></pre>
<p>0.5为边框的透明度（0到1）</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf drawbox=x=10:y=10:w=300:h=230:color=pink@0.5:t=10 out_source
</code></pre>
<p>t为边框厚度</p>
<h2 id="13画网格">13.画网格</h2>
<p>参数drawgrid。</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf drawgrid=w=iw/3:h=ih/3:t=2:c=white@0.5 out_source
</code></pre>
<p>画一个3*3的白色的厚度为2，透明度为0.5的网络</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf drawgrid=w=400:h=100:t=2:c=red@0.5 out_source
</code></pre>
<p>画每个单元为400*100的网格</p>
<h2 id="14加底板">14.加底板</h2>
<p>参数pad。</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf pad=500:500:40:40:violet out_source
ffmpeg -i image_source -vf pad=width=500:height=500:x=40:y=40:color=violet out_source
</code></pre>
<p>以上两个命令是一样的效果，增加一个500*500的底面板，(x,y)是原图摆放的位置</p>
<h2 id="15画边缘">15.画边缘</h2>
<p>参数edgedetect。</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf edgedetect=low=0.1:high=0.4 out_source
ffmpeg -i image_source -vf edgedetect=low=0.5:high=0.8 out_source
</code></pre>
<p>low小于等于high，且值的范围为[0,1]，是检测算法使用的阈值。</p>
<h2 id="16加噪音">16.加噪音</h2>
<p>参数noise。</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf noise=alls=100:allf=t+u out_source
</code></pre>
<p>alls表示所有像素成分的强度，范围为[0,100]，默认为0；allf表示所有像素成分的噪音类型，t为临时噪音，u为统一噪音。</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf noise=alls=100:allf=a out_source
</code></pre>
<p>a表示平滑的平均噪音</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf noise=alls=100:allf=p out_source
</code></pre>
<p>p表示随机噪音</p>
<h2 id="17模糊处理">17.模糊处理</h2>
<h3 id="高斯模糊">高斯模糊</h3>
<pre><code class="language-bash">ffmpeg -i image_source -filter_complex gblur=sigma=10 out_source
</code></pre>
<p>glur是高斯blur的缩写<br>
简单来说就是通过周围的像素点计算得到中间像素点的值，ffmpeg中gblur滤镜只考虑了上下左右四个点，然后有一个强度系数sigma。<br>
gblur=sigma=10为模糊程度</p>
<h3 id="方框模糊">方框模糊</h3>
<pre><code class="language-bash">ffmpeg -i image_source -vf boxblur=2 out_source
</code></pre>
<p>值越大越模糊</p>
<h2 id="18光晕">18.光晕</h2>
<p>参数vignette。</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf vignette=PI/4 out_source
</code></pre>
<h2 id="19变色">19.变色</h2>
<h3 id="colorbalance">colorbalance</h3>
<p>调整rgb某个维度的权重实现变色。</p>
<p>选项有三组，分别为rs/gs/bs、rm/gm/bm、rh/gh/bh。每一个选项都指定了目标颜色（rgb中的一个），s表现偏暗，m表现偏中间，h表现偏亮（且平滑）。</p>
<p>选项的值范围为[-1, 1]，正数表示偏向目标颜色，负数表示远离目标颜色。</p>
<p>比如这三个命令：</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf colorbalance=rs=1 out_source
ffmpeg -i image_source -vf colorbalance=rm=1 out_source
ffmpeg -i image_source -vf colorbalance=rh=1 out_source
ffmpeg -i image_source -vf colorbalance=rh=-0.6 out_source
</code></pre>
<h3 id="colorchannelmixer">colorchannelmixer</h3>
<p>对rgba四个通道进行重新计算，并分别给定权重比例。</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf colorchannelmixer=.3:.4:.3:0:.3:.4:.3:0:.3:.4:.3 out_source
ffmpeg -i image_source -vf colorchannelmixer=.393:.769:.189:0:.349:.686:.168:0:.272:.534:.131 out_source
</code></pre>
<p>每个通道的权重从0到1，先给red的计算权重，即red=redrr + bluerb + greenrg +<br>
alphara，然后分别是green跟blue的计算权重。</p>
<h3 id="hue">hue</h3>
<p>改变色调，相当在调色板上调色。</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf hue=h=30:s=1 out_source
</code></pre>
<p>s为饱和度，范围为[-10,10]，默认为1。h为角度，不同角度有不同的颜色布局（类比调色板），范围为[0,360]，超过360则相当于从0开始，默认为0，在360时，就是原图。</p>
<h3 id="lutlutyuvlutrgb">lut/lutyuv/lutrgb</h3>
<pre><code class="language-bash">ffmpeg -i image_source -vf lutyuv=&quot;y=maxval+minval-val:u=maxval+minval-val:v=maxval+minval-val&quot; out_source
ffmpeg -i image_source -vf lutyuv=&quot;y=negval:u=negval:v=negval&quot; out_source
</code></pre>
<p>lutyuv用于yuv颜色空间。这两个命令的效果是一样的，都是反转，得到底片的效果</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf lutyuv=y=negval out_source
</code></pre>
<p>把亮度（y）反转</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf lutyuv=&quot;u=128:v=128&quot; out_source
</code></pre>
<p>把色度移除（uv），得到黑白图</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf lutyuv=&quot;y=2*val&quot; out_source
</code></pre>
<p>提升亮度</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf lutyuv='u=1.2val:v=1.1val' out_source
</code></pre>
<p>调整uv的值</p>
<h3 id="negate">negate</h3>
<p>反转，得到底片的效果，参数值为0或1，为1时表示把alpha通道也反转，默认为0。</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf negate=0 out_source
</code></pre>
<h3 id="swapuv">swapuv</h3>
<p>uv互换。</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf swapuv out_source
</code></pre>
<h2 id="20eq效果">20.eq效果</h2>
<p>参数为eq，可以调整亮度、饱和度、对比度等。</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf eq=brightness=0.2 out_source
</code></pre>
<p>brightness为亮度，值范围为[-1,1]</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf eq=contrast=1.5 out_source
</code></pre>
<p>contrast是对比度，值范围为[-2, 2]</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf eq=saturation=0.1 out_source
</code></pre>
<p>saturation是饱和度，值范围为[0,3]，默认是1</p>
<pre><code class="language-bash">ffmpeg -i image_source -vf eq=gamma_r=0.2 out_source
</code></pre>
<p>调整gamma系数，范围为[0.1,10]，默认是1</p>
<h2 id="21多张图片合成视频">21.多张图片合成视频</h2>
<pre><code class="language-bash">ffmpeg -r 25 -i %d.png -vcodec libx264 out_source
</code></pre>
<p>-r指定帧率，%d表示将按数字顺序读取PNG文件，-vcodec指定视频编码器，-b:v调整视频码率，-crf调整视频质量，-vf scale 调整视频分辨率</p>
<h2 id="22视频图片提取">22.视频图片提取</h2>
<pre><code class="language-bash">ffmpeg -i image_source ./test/0_%05d.jpg
ffmpeg -i image_source -ss 0:0:29 -t 0:0:8 -r 16 -f image2 ./test/0_%05d.jpg
</code></pre>
<h3 id="获取视频关键帧并保存成jpg图像">获取视频关键帧并保存成jpg图像</h3>
<h4 id="1秒取1帧-rrate">1秒取1帧 r:rate</h4>
<pre><code class="language-bash">ffmpeg -i image_source -f image2 -r 1  dstPath/image-%03d.jpg
</code></pre>
<h4 id="提取i帧">提取I帧</h4>
<pre><code class="language-bash">ffmpeg -i image_source -an -vf select='eq(pict_type\,I)' -vsync 2 -s 720*480 -f image2  dstPath/image-%03d.jpg
</code></pre>
<h1 id="参考文章">参考文章</h1>
<p><a href="https://www.jianshu.com/p/b53943fc3819">FFmpeg----图片处理</a><br>
<a href="https://blog.csdn.net/weixin_46770425/article/details/125530839">ffmpeg对图片模糊处理</a><br>
<a href="https://blog.csdn.net/fantasy_ARM9/article/details/125805480">ffmpeg中的gblur实现</a><br>
<a href="https://www.cnblogs.com/MikeZhang/p/ffmpegToImages-20211013.html">使用ffmpeg进行视频图片提取</a><br>
<a href="https://www.cnblogs.com/HelloCodeWrold/p/12967910.html">FFMPEG获取视频关键帧并保存成jpg图像</a><br>
<a href="https://www.cnblogs.com/freeself/p/14277028.html">多媒体开发（6）：用滤镜实现各种图片效果</a></p>

              </div>
              <hr class="clear">
              
                <div class="next-post">
                  <a class="purple-link" href="https://xiaxi626.github.io/post/ffmpeg-ru-men-ji-jian-dan-jiao-cheng/">
                    <h3 class="post-title">
                      下一篇：FFmpeg入门级简单教程
                    </h3>
                  </a>
                </div>
                
            </div>
          </div>
      </div>

      
          <div id="gitalk-container"></div>
      

    
    </div>
    <div class="site-footer">
  <div class="social-container">
    
      
        <a href="https://github.com/xiaxi626" target="_blank">
          <i class="fab fa-github"></i>
        </a>
      
    
      
    
      
    
      
    
      
        <a href="https://space.bilibili.com/328031473/bangumi" target="_blank">
          <i class="fab fa-bilibili"></i>
        </a>
      
    
      
        <a href="https://www.zhihu.com/people/xiao-yan-shi-36" target="_blank">
          <i class="fab fa-zhihu"></i>
        </a>
      
    
  </div>
  <div class="slogan">温故而知新</div> |
  <a href="https://github.com/Decade-qiu/gridea-theme-Eternal" target="_blank">Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a></a> | <a href="https://github.com/Decade-qiu/gridea-theme-Eternal" target="_blank">Powered by Eternal</a> | <a href="https://xiaxi626.github.io/atom.xml" target="_blank">RSS</a>
</div>

    <script src="https://xiaxi626.github.io/media/scripts/index.js"></script>


    <script src='https://xiaxi626.github.io/media/scripts/valine.min.js'></script>
    <script>
        new Valine({
            el: '#gitalk-container',
            appId: '2EhI3kZCg0PpwHaW4CRpwsYu-gzGzoHsz',
            appKey: 'XEh9nruDRqlHqqfaFkHmeyKq',
            placeholder: 'Write something...',
        })
    </script>



  </body>
</html>

<script>
    window.onload = function() {
        let id = 1;
        let post_content = document.querySelector('.content-card');
        post_content.querySelectorAll('h1,h2,h3,h4,h5,h6').forEach(function (item) {
            item.setAttribute('id', 'toc-' + id);
            id++;
        });
        tocbot.init({
            tocSelector: '.toc',
            contentSelector: '.post-content',
            headingSelector: 'h1,h2,h3,h4',
            headingsOffset: 58,
        });
        // 检测页面滚动距离 用eventlistener
        window.addEventListener('scroll', function () {
            let scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
            let toc = document.querySelector('.toc');
            let tocBtn = document.querySelector('.toc-body');
            if (scrollTop > 250) {
                tocBtn.classList.add('toc-body-fixed');
                toc.classList.add('toc-fixed');
            } else {
                tocBtn.classList.remove('toc-body-fixed');
                toc.classList.remove('toc-fixed');
            }
        });
        document.querySelector('#floating-toc-btn').addEventListener('click', function () {
            let toc = document.querySelector('.toc-body');
            let main = document.querySelector('.main');
            if (toc.classList.contains('hide')) {
                main.classList.add('main-small');
                toc.classList.remove('hide');
            } else {
                toc.classList.add('hide');
                main.classList.remove('main-small');
            }
        });
        window.addEventListener('resize', function() {
            // 获取屏幕宽度
            var screenWidth = window.innerWidth || document.documentElement.clientWidth;
            // 设置 .content-card 的 max-width
            var contentCard = document.querySelector('.content-card');
            contentCard.style.maxWidth = screenWidth + 'px';
        });
        // 初始加载时执行一次，确保初始状态下也设置正确
        window.dispatchEvent(new Event('resize'));
    };
</script>
